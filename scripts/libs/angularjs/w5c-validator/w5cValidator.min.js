/*! ng-w5c-validator v2.4.24 2017-01-10 */
(function(){var a=angular.module("w5c.validator",["ng"]).provider("w5cValidator",[function(){var c={required:"该项不能为空",maxlength:"该项输入值长度不能大于{maxlength}",minlength:"该项输入值长度不能小于{minlength}",email:"输入邮件的格式不正确",repeat:"两次输入不一致",pattern:"该项输入格式不正确",number:"必须输入数字",w5cuniquecheck:"该输入值已经存在，请重新输入",url:"输入URL格式不正确",max:"该项输入值不能大于{max}",min:"该项输入值不能小于{min}",customizer:"自定义验证不通过"},b=["text","password","email","number","url","tel","hidden",["textarea"],["select"],["select-multiple"],["select-one"],"radio","checkbox"];var f=function(g){if(g[0].tagName==="FORM"||g[0].nodeType==11){return null}if(g&&g.hasClass("form-group")){return g}else{return f(g.parent())}};var e=function(){this.elemTypes=b;this.rules={};this.isEmpty=function(g){if(!g){return true}if(g instanceof Array&&g.length===0){return true}return false};this.defaultShowError=function(j,k){var h=angular.element(j);var i=f(h);if(!this.isEmpty(i)&&!i.hasClass("has-error")){i.addClass("has-error")}var g=h.next();if(!g||!g.hasClass("w5c-error")){h.after('<span class="w5c-error">'+k[0]+"</span>")}};this.defaultRemoveError=function(j){var h=angular.element(j);var i=f(h);if(!this.isEmpty(i)&&i.hasClass("has-error")){i.removeClass("has-error")}var g=h.next();if(g.hasClass&&g.hasClass("w5c-error")){g.remove()}};this.options={blurTrig:false,showError:true,removeError:true}};e.prototype={constructor:e,config:function(g){this.options=angular.extend(this.options,g)},setRules:function(g){this.rules=angular.extend(this.rules,g)},getErrorMessage:function(j,h){var i=null;var g=h.name;if(g&&/\$\d+\$/i.test(g)){g=g.replace(/\$\d+\$/i,"")}if(!this.isEmpty(this.rules[g])&&!this.isEmpty(this.rules[g][j])){i=this.rules[g][j]}switch(j){case"maxlength":return(i||c.maxlength).replace("{maxlength}",h.getAttribute("ng-maxlength"));case"minlength":return(i||c.minlength).replace("{minlength}",h.getAttribute("ng-minlength"));case"max":return(i||c.max).replace("{max}",h.getAttribute("max"));case"min":return(i||c.min).replace("{min}",h.getAttribute("min"));default:if(i!==null){return i}if(c[j]===null){throw new Error("该验证规则("+j+")默认错误信息没有设置！")}return c[j]}},getErrorMessages:function(i,k){var g=[];for(var h in k){if(k[h]){var j=this.getErrorMessage(h,i);g.push(j)}}return g},showError:function(i,j,h){var g=angular.extend({},this.options,h);angular.element(i).removeClass("valid").addClass("error");if(g.showError===false){return}if(angular.isFunction(g.showError)){return g.showError(i,j)}if(g.showError===true){return this.defaultShowError(i,j)}},removeError:function(i,h){var g=angular.extend({},this.options,h);angular.element(i).removeClass("error").addClass("valid");if(g.removeError===false){return}if(angular.isFunction(g.removeError)){return g.removeError(i)}if(g.removeError===true){return this.defaultRemoveError(i)}}};var d=new e();this.config=function(g){d.config(g)};this.setRules=function(g){d.setRules(g)};this.setDefaultRules=function(g){c=angular.extend(c,g)};this.$get=function(){return d}}]);if(typeof module!=="undefined"&&typeof exports!=="undefined"&&module.exports===exports){module.exports=a.name}})();(function(){angular.module("w5c.validator").directive("w5cFormValidate",["$parse","w5cValidator","$timeout",function(c,b,a){return{require:["w5cFormValidate","^?form"],controller:["$scope","$element","$attrs",function(g,f,e){var d=this;var i=f[0];this.needBindKeydown=false;this.formCtrl=null;this.submitSuccessFn=null;this.validElements=[];this.setValidate=function(l){this.formCtrl=l;var k=function(){var q=[];for(var n=0;n<i.elements.length;n++){var p=i.elements[n].name;if(p&&d.validElements.indexOf(p)>=0){var o=i[p];if(l[p]&&o&&b.elemTypes.toString().indexOf(o.type)>-1&&!b.isEmpty(p)){if(l[p].$valid){angular.element(o).removeClass("error").addClass("valid");continue}else{var m=b.getErrorMessages(o,l[o.name].$error);q.push(m[0]);b.removeError(o,d.options);b.showError(o,m,d.options);l[p].w5cError=true}}}}if(!b.isEmpty(q)&&q.length>0){l.$errors=q}else{l.$errors=[]}if(!g.$$phase){g.$apply(l.$errors)}};l.doValidate=k;l.reset=function(){a(function(){l.$setPristine();for(var n=0;n<i.elements.length;n++){var o=i.elements[n];var m=angular.element(o);b.removeError(m,d.options)}l.$errors=[]})};var j=c(e.w5cSubmit);if(e.w5cSubmit&&angular.isFunction(j)){f.bind("submit",function(m){k();if(l.$valid&&angular.isFunction(j)){g.$apply(function(){j(g,{$event:m})})}});this.needBindKeydown=true}if(this.needBindKeydown){f.bind("keydown keypress",function(o){if(o.which===13){var m=document.activeElement;if(m.type&&m.type!=="textarea"){var n=f.find("button");if(n&&n[0]){n[0].focus()}m.focus();k();o.preventDefault();if(l.$valid&&angular.isFunction(d.submitSuccessFn)){g.$apply(function(){d.submitSuccessFn(g,{$event:o})})}}}})}};this.doValidate=function(k,j){if(angular.isFunction(this.formCtrl.doValidate)){this.formCtrl.doValidate()}if(this.formCtrl.$valid&&angular.isFunction(k)){g.$apply(function(){k(g,{$event:j})})}};this.removeElementValidation=function(k){var j=this.validElements.indexOf(k);if(j>=0){this.validElements.splice(j,1);if(!b.isEmpty(this.formCtrl.$errors)){this.doValidate(angular.noop)}}};this.removeError=function(j){this.formCtrl.$errors=[];this.formCtrl[j[0].name]&&(this.formCtrl[j[0].name].w5cError=false);b.removeError(j,this.options)};this.initElement=function(m){var k=angular.element(m);var n=this;if(b.elemTypes.toString().indexOf(m.type)>-1&&!b.isEmpty(m.name)&&!/^\d/.test(m.name)){var l=k.attr("disabled");if(l&&(l==="true"||l==="disabled")){return}if(this.validElements.indexOf(m.name)<0){this.validElements.push(m.name)}else{return}var j=this.formName+"."+m.name+".$viewValue";g.$watch(j,function(){n.removeError(k)},true);if(n.options&&n.options.blurTrig){k.bind("blur",function(){if(!n.options.blurTrig){return}var p=this;var o=angular.element(this);a(function(){if(!d.formCtrl[p.name].$valid){var q=b.getErrorMessages(p,d.formCtrl[p.name].$error);b.showError(o,q,d.options);if(d.formCtrl[o[0].name]){d.formCtrl[o[0].name].w5cError=true}}else{b.removeError(o,d.options)}},50)})}}};var h;this._init=function(){h=b.rules;this.formName=f.attr("name");if(!this.formName){throw Error("form must has name when use w5cFormValidate")}var j=g.$eval(e.w5cFormValidate);if(e.w5cFormValidate){g.$watch(e.w5cFormValidate,function(l){if(l){d.options=j=angular.extend({},b.options,l.options)}if(l.rules){b.setRules(l.rules)}},true)}this.options=angular.extend({},b.options,j);for(var k=0;k<f[0].elements.length;k++){this.initElement(f[0].elements[k])}};this._init();g.$on("$destroy",function(){b.setRules(h)})}],link:function(f,g,e,d){var h=d[0],i=d[1];h.setValidate(i)}}}]).directive("w5cFormSubmit",["$parse",function(a){return{require:"^w5cFormValidate",link:function(d,c,b,e){var f=a(b.w5cFormSubmit);c.bind("click",function(g){e.doValidate(f,g)});e.needBindKeydown=true;e.submitSuccessFn=f}}}]).directive("w5cRepeat",["$timeout",function(a){return{require:["ngModel","^w5cFormValidate"],link:function(d,e,c,b){a(function(){var h=e.inheritedData("$formController")[c.w5cRepeat];var g=b[0],f=b[1];g.$parsers.push(function(i){if(i===h.$viewValue){g.$setValidity("repeat",true)}else{g.$setValidity("repeat",false)}return i});h.$parsers.push(function(i){g.$setValidity("repeat",i===g.$viewValue);if(i===g.$viewValue){f.removeError(e)}return i})})}}}]).directive("w5cCustomizer",["$timeout",function(a){return{require:["^form","?ngModel"],link:function(e,g,d,b){var c=b[1];var h=function(){var i=e.$eval(d.w5cCustomizer);if(i===true){c.$setValidity("customizer",true)}else{c.$setValidity("customizer",false)}};var f=b[0][d.associate];f&&f.$viewChangeListeners.push(h);c.$viewChangeListeners.push(h);h()}}}]).directive("w5cUniqueCheck",["$timeout","$http","w5cValidator",function(b,c,a){return{require:["ngModel","?^w5cFormValidate","?^form"],link:function(k,e,j,g){var d=g[0],l=g[1],i=g[2];var h=function(){var o=k.$eval(j.w5cUniqueCheck);var n=o.url;var m=o.isExists;c.get(n).success(function(r){var q=m===false?(r=="true"||r==true):!(r=="true"||r==true);d.$setValidity("w5cuniquecheck",q);if(!q){var p=a.getErrorMessage("w5cuniquecheck",e[0]);a.showError(e[0],[p],l.options);if(i[e[0].name]){i[e[0].name].w5cError=true}if(!i.$errors){i.$errors=[p]}else{i.$errors.unshift(p)}}})};d.$viewChangeListeners.push(function(){i.$errors=[];d.$setValidity("w5cuniquecheck",true);if(d.$invalid&&!d.$error.w5cuniquecheck){return}if(d.$dirty){h()}});var f=k.$eval(j.ngModel);if(f){if(d.$invalid&&!d.$error.w5cuniquecheck){return}h()}}}}]).directive("w5cDynamicName",[function(){return{restrict:"A",require:"?ngModel",link:function(b,e,a,c){c.$name=b.$eval(a.w5cDynamicName);e.attr("name",b.$eval(a.w5cDynamicName));var d=e.controller("form")||{$addControl:angular.noop};d.$addControl(c)}}}]).directive("w5cDynamicElement",["$timeout",function(a){return{restrict:"A",require:["?ngModel","?^w5cFormValidate","?^form"],link:function(f,h,e,c){var d=h[0].name,g=c[2];if(d){h.on("$destroy",function(i){if(f[g.$name]){c[1].removeElementValidation(d)}});if(!g[d]){g.$addControl(c[0])}var b=false;if(c[2].$errors&&c[2].$errors.length>0){b=true}c[1].initElement(h[0]);if(b){a(function(){c[1].doValidate(angular.noop)})}}}}}])})();