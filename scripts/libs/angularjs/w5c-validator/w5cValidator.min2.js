!function(){var e=angular.module("w5c.validator",["ng"]).provider("w5cValidator",[function(){var e={required:"该项不能为空",maxlength:"该项输入值长度不能大于{maxlength}",minlength:"该项输入值长度不能小于{minlength}",email:"输入邮件的格式不正确",repeat:"两次输入不一致",pattern:"该项输入格式不正确",number:"必须输入数字",w5cuniquecheck:"该输入值已经存在，请重新输入",w5cremotecheck:"该项格式不正确",url:"输入URL格式不正确",max:"该项输入值不能大于{max}",min:"该项输入值不能小于{min}",customizer:"自定义验证不通过"},r=["text","password","email","number","url","tel","hidden",["textarea"],["select"],["select-multiple"],["select-one"],"radio","checkbox"],t=function(e){return"FORM"===e[0].tagName||11==e[0].nodeType?null:e&&e.hasClass("form-group")?e:t(e.parent())},n=function(){this.elemTypes=r,this.rules={},this.isEmpty=function(e){return e?e instanceof Array&&0===e.length?!0:!1:!0},this.defaultShowError=function(e,r){var n=angular.element(e),i=t(n);this.isEmpty(i)||i.hasClass("has-error")||i.addClass("has-error");var o=n.next();o&&o.hasClass("w5c-error")||n.after('<span class="w5c-error">'+r[0]+"</span>")},this.defaultRemoveError=function(e){var r=angular.element(e),n=t(r);!this.isEmpty(n)&&n.hasClass("has-error")&&n.removeClass("has-error");var i=r.next();i.hasClass&&i.hasClass("w5c-error")&&i.remove()},this.options={blurTrig:!1,showError:!0,removeError:!0}};n.prototype={constructor:n,config:function(e){this.options=angular.extend(this.options,e)},setRules:function(e){this.rules=angular.extend(this.rules,e)},getErrorMessage:function(r,t){var n=null,i=t.name;switch(i&&/\$\d+\$/i.test(i)&&(i=i.replace(/\$\d+\$/i,"")),this.isEmpty(this.rules[i])||this.isEmpty(this.rules[i][r])||(n=this.rules[i][r]),r){case"maxlength":return(n||e.maxlength).replace("{maxlength}",t.getAttribute("ng-maxlength"));case"minlength":return(n||e.minlength).replace("{minlength}",t.getAttribute("ng-minlength"));case"max":return(n||e.max).replace("{max}",t.getAttribute("max"));case"min":return(n||e.min).replace("{min}",t.getAttribute("min"));default:if(null!==n)return n;if(null===e[r])throw new Error("该验证规则("+r+")默认错误信息没有设置！");return e[r]}},getErrorMessages:function(e,r){var t=[];for(var n in r)if(r[n]){var i=this.getErrorMessage(n,e);t.push(i)}return t},showError:function(e,r,t){var n=angular.extend({},this.options,t);return angular.element(e).removeClass("valid").addClass("error"),n.showError!==!1?angular.isFunction(n.showError)?n.showError(e,r):n.showError===!0?this.defaultShowError(e,r):void 0:void 0},removeError:function(e,r){var t=angular.extend({},this.options,r);return angular.element(e).removeClass("error").addClass("valid"),t.removeError!==!1?angular.isFunction(t.removeError)?t.removeError(e):t.removeError===!0?this.defaultRemoveError(e):void 0:void 0}};var i=new n;this.config=function(e){i.config(e)},this.setRules=function(e){i.setRules(e)},this.setDefaultRules=function(r){e=angular.extend(e,r)},this.$get=function(){return i}}]);"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports=e.name)}(),function(){angular.module("w5c.validator").directive("w5cFormValidate",["$parse","w5cValidator","$timeout",function(e,r,t){return{require:["w5cFormValidate","^?form"],controller:["$scope","$element","$attrs",function(n,i,o){var a=this,s=i[0];this.needBindKeydown=!1,this.formCtrl=null,this.submitSuccessFn=null,this.validElements=[],this.setValidate=function(l){this.formCtrl=l;var u=function(){for(var e=[],t=0;t<s.elements.length;t++){var i=s.elements[t].name;if(i&&a.validElements.indexOf(i)>=0){var o=s[i];if(l[i]&&o&&r.elemTypes.toString().indexOf(o.type)>-1&&!r.isEmpty(i)){if(l[i].$valid){angular.element(o).removeClass("error").addClass("valid");continue}var u=r.getErrorMessages(o,l[o.name].$error);e.push(u[0]),r.removeError(o,a.options),r.showError(o,u,a.options),l[i].w5cError=!0}}}!r.isEmpty(e)&&e.length>0?l.$errors=e:l.$errors=[],n.$$phase||n.$apply(l.$errors)};l.doValidate=u,l.reset=function(){t(function(){l.$setPristine();for(var e=0;e<s.elements.length;e++){var t=s.elements[e],n=angular.element(t);r.removeError(n,a.options)}l.$errors=[]})};var c=e(o.w5cSubmit);o.w5cSubmit&&angular.isFunction(c)&&(i.bind("submit",function(e){u(),l.$valid&&angular.isFunction(c)&&n.$apply(function(){c(n,{$event:e})})}),this.needBindKeydown=!0),this.needBindKeydown&&i.bind("keydown keypress",function(e){if(13===e.which){var r=document.activeElement;if(r.type&&"textarea"!==r.type){var t=i.find("button");t&&t[0]&&t[0].focus(),r.focus(),u(),e.preventDefault(),l.$valid&&angular.isFunction(a.submitSuccessFn)&&n.$apply(function(){a.submitSuccessFn(n,{$event:e})})}}})},this.doValidate=function(e,r){angular.isFunction(this.formCtrl.doValidate)&&this.formCtrl.doValidate(),this.formCtrl.$valid&&angular.isFunction(e)&&n.$apply(function(){e(n,{$event:r})})},this.removeElementValidation=function(e){var t=this.validElements.indexOf(e);t>=0&&(this.validElements.splice(t,1),r.isEmpty(this.formCtrl.$errors)||this.doValidate(angular.noop))},this.removeError=function(e){this.formCtrl.$errors=[],this.formCtrl[e[0].name]&&(this.formCtrl[e[0].name].w5cError=!1),r.removeError(e,this.options)},this.initElement=function(e){var i=angular.element(e),o=this;if(r.elemTypes.toString().indexOf(e.type)>-1&&!r.isEmpty(e.name)&&!/^\d/.test(e.name)){var s=i.attr("disabled");if(s&&("true"===s||"disabled"===s))return;if(!(this.validElements.indexOf(e.name)<0))return;this.validElements.push(e.name);var l=this.formName+"."+e.name+".$viewValue";n.$watch(l,function(){o.removeError(i)},!0),o.options&&o.options.blurTrig&&i.bind("blur",function(){if(o.options.blurTrig){var e=this,n=angular.element(this);t(function(){if(a.formCtrl[e.name].$valid)r.removeError(n,a.options);else{var t=r.getErrorMessages(e,a.formCtrl[e.name].$error);r.showError(n,t,a.options),a.formCtrl[n[0].name]&&(a.formCtrl[n[0].name].w5cError=!0)}},50)}})}};var l;this._init=function(){if(l=r.rules,this.formName=i.attr("name"),!this.formName)throw Error("form must has name when use w5cFormValidate");var e=n.$eval(o.w5cFormValidate);o.w5cFormValidate&&n.$watch(o.w5cFormValidate,function(t){t&&(a.options=e=angular.extend({},r.options,t.options)),t.rules&&r.setRules(t.rules)},!0),this.options=angular.extend({},r.options,e);for(var t=0;t<i[0].elements.length;t++)this.initElement(i[0].elements[t])},this._init(),n.$on("$destroy",function(){r.setRules(l)})}],link:function(e,r,t,n){var i=n[0],o=n[1];i.setValidate(o)}}}]).directive("w5cFormSubmit",["$parse",function(e){return{require:"^w5cFormValidate",link:function(r,t,n,i){var o=e(n.w5cFormSubmit);t.bind("click",function(e){i.doValidate(o,e)}),i.needBindKeydown=!0,i.submitSuccessFn=o}}}]).directive("w5cRepeat",["$timeout",function(e){"use strict";return{require:["ngModel","^w5cFormValidate"],link:function(r,t,n,i){e(function(){var e=t.inheritedData("$formController")[n.w5cRepeat],r=i[0],o=i[1];r.$parsers.push(function(t){return t===e.$viewValue?r.$setValidity("repeat",!0):r.$setValidity("repeat",!1),t}),e.$parsers.push(function(e){return r.$setValidity("repeat",e===r.$viewValue),e===r.$viewValue&&o.removeError(t),e})})}}}]).directive("w5cCustomizer",["$timeout",function(e){"use strict";return{require:["^form","?ngModel"],link:function(e,r,t,n){var i=n[1],o=function(){var r=e.$eval(t.w5cCustomizer);r===!0?i.$setValidity("customizer",!0):i.$setValidity("customizer",!1)},a=n[0][t.associate];a&&a.$viewChangeListeners.push(o),i.$viewChangeListeners.push(o),o()}}}]).directive("w5cUniqueCheck",["$timeout","$http","w5cValidator",function(e,r,t){return{require:["ngModel","?^w5cFormValidate","?^form"],link:function(e,n,i,o){var a=o[0],s=o[1],l=o[2],u=function(){var o=e.$eval(i.w5cUniqueCheck),u=o.url,c=o.isExists;r.get(u).success(function(e){var r=c===!1?"true"==e||1==e:!("true"==e||1==e);if(a.$setValidity("w5cuniquecheck",r),r)t.removeError(n,s.options);else{var i=t.getErrorMessage("w5cuniquecheck",n[0]);t.showError(n[0],[i],s.options),l[n[0].name]&&(l[n[0].name].w5cError=!0),l.$errors?l.$errors.unshift(i):l.$errors=[i]}})};a.$viewChangeListeners.push(function(){l.$errors=[],a.$setValidity("w5cuniquecheck",!0),(!a.$invalid||a.$error.w5cuniquecheck)&&a.$dirty&&u()});var c=e.$eval(i.ngModel);if(c){if(a.$invalid&&!a.$error.w5cuniquecheck)return;u()}}}}]).directive("w5cRemoteCheck",["$timeout","$http","w5cValidator",function(e,r,t){return{require:["ngModel","?^w5cFormValidate","?^form"],link:function(e,n,i,o){var a=o[0],s=o[1],l=o[2],u=function(){var o=e.$eval(i.w5cRemoteCheck),u=o.url;r.get(u).success(function(e){var r=o.compare(e);if(a.$setValidity("w5cremotecheck",r),r)t.removeError(n,s.options);else{var i=t.getErrorMessage("w5cremotecheck",n[0]);t.showError(n[0],[i],s.options),l[n[0].name]&&(l[n[0].name].w5cError=!0),l.$errors?l.$errors.unshift(i):l.$errors=[i]}})};a.$viewChangeListeners.push(function(){l.$errors=[],a.$setValidity("w5cremotecheck",!0),(!a.$invalid||a.$error.w5cremotecheck)&&a.$dirty&&u()});var c=e.$eval(i.ngModel);if(c){if(a.$invalid&&!a.$error.w5cremotecheck)return;u()}}}}]).directive("w5cDynamicCustomizer",["$timeout","$http","w5cValidator",function(e,r,t){return{require:["ngModel","?^w5cFormValidate","?^form"],link:function(e,r,n,i){var o=i[0],a=i[1],s=i[2],l=function(){var i=e.$eval(n.w5cDynamicCustomizer);if(o.$setValidity("w5cDynamicCustomizer",i),i)t.removeError(r,a.options);else{var l=t.getErrorMessage("w5cDynamicCustomizer",r[0]);t.showError(r[0],[l],a.options),s[r[0].name]&&(s[r[0].name].w5cError=!0),s.$errors?s.$errors.unshift(l):s.$errors=[l]}};o.$viewChangeListeners.push(function(){s.$errors=[],o.$setValidity("w5cDynamicCustomizer",!0),(!o.$invalid||o.$error.w5cDynamicCustomizer)&&o.$dirty&&l()});var u=e.$eval(n.ngModel);if(u){if(o.$invalid&&!o.$error.w5cDynamicCustomizer)return;l()}}}}]).directive("w5cDynamicName",[function(){return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){n.$name=e.$eval(t.w5cDynamicName),r.attr("name",e.$eval(t.w5cDynamicName));var i=r.controller("form")||{$addControl:angular.noop};i.$addControl(n)}}}]).directive("w5cDynamicElement",["$timeout",function(e){return{restrict:"A",require:["?ngModel","?^w5cFormValidate","?^form"],link:function(r,t,n,i){var o=t[0].name,a=i[2];if(o){t.on("$destroy",function(e){r[a.$name]&&i[1].removeElementValidation(o)}),a[o]||a.$addControl(i[0]);var s=!1;i[2].$errors&&i[2].$errors.length>0&&(s=!0),i[1].initElement(t[0]),s&&e(function(){i[1].doValidate(angular.noop)})}}}}])}();